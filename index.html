<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BrÃºjula Interna</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />
  <meta name="theme-color" content="#d1fae5" />
  <style>
    body {
      background-color: #d1fae5;
      color: #064e3b;
      font-family: sans-serif;
      font-size: 1.1rem;
      padding: 2rem;
      max-width: 700px;
      margin: auto;
    }
    h1 {
      font-size: 1.8rem;
      margin-top: 1rem;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    input, textarea, select, button {
      width: 100%;
      padding: 1rem;
      margin-top: 1rem;
      border-radius: 0.5rem;
      border: none;
      font-size: 1rem;
    }
    button {
      background-color: #10b981;
      color: white;
      font-weight: bold;
      cursor: pointer;
      margin-top: 1.5rem;
    }
    .branding {
      font-size: 1rem;
      font-weight: bold;
      text-align: center;
      margin-top: 2rem;
      color: #065f46;
    }
    .frase {
      font-style: italic;
      margin-bottom: 1.2rem;
      color: #047857;
    }
    .selector {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 2rem;
    }
    #imagen-preview {
      margin-top: 1rem;
      max-width: 100%;
      border-radius: 10px;
    }
    .historial-item {
      padding: 1rem;
      border-bottom: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <div class="branding">ğŸ§­ BrÃºjula Interna 3.0</div>

  <!-- Pantalla inicial -->
  <div class="step active" id="inicio">
    <h1>Â¿DÃ³nde te encuentras en tu dÃ­a?</h1>
    <p class="frase">Escoge tu momento. No importa la hora, importa tu intenciÃ³n.</p>
    <div class="selector">
      <button onclick="iniciarManana()">ğŸŒ… Empezar mi dÃ­a</button>
      <button onclick="iniciarNoche()">ğŸŒ‡ Reflexionar mi dÃ­a</button>
      <button onclick="mostrarHistorial()">ğŸ“† Ver mi semana</button>
    </div>
  </div>
  <!-- Modo MAÃ‘ANA -->
  <div class="step" id="manana">
    <h1>ğŸŒ Rumbo del dÃ­a</h1>
    <p class="frase" id="fraseManana"></p>
    <label>ğŸ¯ Â¿QuÃ© 3 cosas quiero hacer hoy?</label>
    <input type="text" id="m1" placeholder="Ej: Salir a caminar" />
    <input type="text" id="m2" placeholder="Ej: Leer 10 minutos" />
    <input type="text" id="m3" placeholder="Ej: Hablar con alguien con calma" />
    <label>ğŸŒ€ Â¿CÃ³mo me siento al comenzar?</label>
    <select id="energia">
      <option value="Alta">Alta âš¡</option>
      <option value="Media">Media ğŸ”„</option>
      <option value="Baja">Baja ğŸŒ±</option>
    </select>
    <label>ğŸ’š Â¿QuÃ© actitud quiero cultivar?</label>
    <input type="text" id="actitud" placeholder="Ej: Amabilidad / Claridad / Paciencia" />
    <button onclick="guardarManana()">Guardar mi rumbo</button>
  </div>

  <!-- Modo NOCHE -->
  <div class="step" id="noche">
    <h1>ğŸŒ™ BitÃ¡cora del dÃ­a</h1>
    <p class="frase" id="fraseNoche"></p>
    <label>ğŸŒŸ Â¿QuÃ© hice hoy que me gustÃ³?</label>
    <textarea id="logro" rows="2"></textarea>
    <label>ğŸ§± Â¿QuÃ© me costÃ³ mÃ¡s?</label>
    <textarea id="dificil" rows="2"></textarea>
    <label>ğŸ’­ Â¿QuÃ© me repito con cariÃ±o?</label>
    <textarea id="mensaje" rows="2" placeholder="Ej: Estoy aprendiendo a estar presente."></textarea>

    <h2>ğŸŒ± Identidad y evoluciÃ³n</h2>
    <label>ğŸª Â¿QuÃ© hago, siento o pienso que me convierte en un buenâ€¦?</label>
    <textarea id="identidad1" rows="2" placeholder="Ej: estudiante, profesional, cuidador..."></textarea>
    <label>ğŸ§  Â¿QuÃ© comportamientos o acciones me convierten en eso?</label>
    <textarea id="identidad2" rows="2"></textarea>

    <h2>ğŸ“· Imagen opcional</h2>
    <input type="file" accept="image/*" id="imagen" onchange="mostrarImagen(event)">
    <img id="imagen-preview" style="display:none;" />
    <button onclick="quitarImagen()">Quitar imagen</button>

    <button onclick="guardarNoche()">Guardar mi reflexiÃ³n</button>
  </div>
  <!-- Resultado -->
  <div class="step" id="resultado">
    <h1>ğŸ“– Tu registro de hoy</h1>
    <div id="resumen"></div>
    <button onclick="copiarTexto()">ğŸ“‹ Copiar texto</button>
    <button onclick="exportarComoPNG()">ğŸ–¼ï¸ Guardar como imagen</button>
    <button onclick="reiniciar()">Registrar otro momento</button>
  </div>

  <!-- Historial -->
  <div class="step" id="historial">
    <h1>ğŸ“† Mi semana</h1>
    <div id="lista-historial"></div>
    <button onclick="reiniciar()">Volver al inicio</button>
  </div>

  <script>
    const frasesManana = [
      "Hoy no tienes que hacerlo todo. Solo avanzar con intenciÃ³n.",
      "Un dÃ­a amable comienza con una pausa consciente.",
      "EstÃ¡s trazando tu rumbo. Cada paso importa.",
      "Iniciar con claridad es un acto de cuidado personal."
    ];
    const frasesNoche = [
      "Hoy ya forma parte de tu camino.",
      "Todo lo que hiciste (o no), te enseÃ±Ã³ algo.",
      "Cerrar el dÃ­a es tambiÃ©n un acto de amor propio.",
      "Tu brÃºjula sigue activa, incluso cuando descansas."
    ];

    let imagenSeleccionada = null;

    function mostrarPaso(id) {
      document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function iniciarManana() {
      document.getElementById('fraseManana').textContent = frasesManana[Math.floor(Math.random() * frasesManana.length)];
      mostrarPaso('manana');
    }

    function iniciarNoche() {
      document.getElementById('fraseNoche').textContent = frasesNoche[Math.floor(Math.random() * frasesNoche.length)];
      mostrarPaso('noche');
    }

    function guardarManana() {
      const data = {
        fecha: new Date().toLocaleDateString(),
        tipo: 'maÃ±ana',
        m1: document.getElementById('m1').value,
        m2: document.getElementById('m2').value,
        m3: document.getElementById('m3').value,
        energia: document.getElementById('energia').value,
        actitud: document.getElementById('actitud').value
      };
      guardarEnHistorial(data);
      mostrarResumen(data);
    }

    function guardarNoche() {
      const data = {
        fecha: new Date().toLocaleDateString(),
        tipo: 'noche',
        logro: document.getElementById('logro').value,
        dificil: document.getElementById('dificil').value,
        mensaje: document.getElementById('mensaje').value,
        identidad1: document.getElementById('identidad1').value,
        identidad2: document.getElementById('identidad2').value,
        imagen: imagenSeleccionada
      };
      guardarEnHistorial(data);
      mostrarResumen(data);
    }

    function mostrarResumen(data) {
      let resumen = `<p><strong>ğŸ“… Fecha:</strong> ${data.fecha}</p>`;

      if (data.tipo === 'maÃ±ana') {
        const emoji = data.energia === 'Alta' ? 'âš¡' : data.energia === 'Media' ? 'ğŸŒ€' : 'ğŸŒ±';
        resumen += `
          <p>ğŸ¯ <strong>Objetivos:</strong><br>â€“ ${data.m1}<br>â€“ ${data.m2}<br>â€“ ${data.m3}</p>
          <p>${emoji} <strong>EnergÃ­a:</strong> ${data.energia}</p>
          <p>ğŸ’š <strong>Actitud:</strong> ${data.actitud}</p>`;
      } else {
        const emLogro = data.logro ? 'ğŸŒŸ' : 'ğŸ«¥';
        const emDif = /frustrado|nada|cansado|difÃ­cil|ansiedad/i.test(data.dificil) ? 'ğŸŒ§ï¸' : 'ğŸ§©';
        const emMsg = data.mensaje ? 'ğŸ’­' : 'ğŸ¤';

        resumen += `
          <p>${emLogro} <strong>Logro:</strong> ${data.logro || 'Sin registrar'}</p>
          <p>${emDif} <strong>Dificultad:</strong> ${data.dificil || 'Sin registrar'}</p>
          <p>${emMsg} <strong>Mensaje amable:</strong> ${data.mensaje || 'Sin registrar'}</p>
          <p>ğŸª <strong>Identidad:</strong> ${data.identidad1 || 'â€”'}<br>ğŸ§  ${data.identidad2 || 'â€”'}</p>`;
        if (data.imagen) {
          resumen += `<p><img src="${data.imagen}" alt="Imagen del dÃ­a" style="max-width:100%; border-radius:10px;" /></p>`;
        }
      }

      document.getElementById('resumen').innerHTML = resumen;
      mostrarPaso('resultado');
    }

    function guardarEnHistorial(data) {
      let historial = JSON.parse(localStorage.getItem('historial-brujula')) || [];
      historial.unshift(data);
      localStorage.setItem('historial-brujula', JSON.stringify(historial.slice(0, 7)));
    }

    function mostrarHistorial() {
      const contenedor = document.getElementById('lista-historial');
      contenedor.innerHTML = '';
      const historial = JSON.parse(localStorage.getItem('historial-brujula')) || [];

      if (historial.length === 0) {
        contenedor.innerHTML = '<p>No hay entradas aÃºn.</p>';
      } else {
        historial.forEach(entry => {
          const emoji = entry.tipo === 'maÃ±ana'
            ? entry.energia === 'Alta' ? 'âš¡' : entry.energia === 'Media' ? 'ğŸŒ€' : 'ğŸŒ±'
            : entry.logro ? 'ğŸŒŸ' : 'ğŸ«¥';
          contenedor.innerHTML += `<div class="historial-item">ğŸ“… ${entry.fecha} â€” ${emoji}</div>`;
        });
      }

      mostrarPaso('historial');
    }

    function reiniciar() {
      mostrarPaso('inicio');
    }

    function mostrarImagen(event) {
      const reader = new FileReader();
      reader.onload = function (e) {
        imagenSeleccionada = e.target.result;
        const img = document.getElementById('imagen-preview');
        img.src = imagenSeleccionada;
        img.style.display = 'block';
      };
      reader.readAsDataURL(event.target.files[0]);
    }

    function quitarImagen() {
      imagenSeleccionada = null;
      const img = document.getElementById('imagen-preview');
      img.src = '';
      img.style.display = 'none';
    }

    function copiarTexto() {
      const resumenText = document.getElementById('resumen').innerText;
      navigator.clipboard.writeText(resumenText).then(() => {
        alert('Texto copiado al portapapeles');
      });
    }

    function exportarComoPNG() {
      html2canvas(document.getElementById('resumen')).then(canvas => {
        const link = document.createElement('a');
        link.download = 'bitacora.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</body>
</html>
