<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Brújula Interna</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />
  <meta name="theme-color" content="#d1fae5" />
  <style>
    body {
      background-color: #d1fae5;
      color: #064e3b;
      font-family: sans-serif;
      font-size: 1.1rem;
      padding: 2rem;
      max-width: 700px;
      margin: auto;
    }
    h1 {
      font-size: 1.8rem;
      margin-top: 1rem;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    input, textarea, select, button {
      width: 100%;
      padding: 1rem;
      margin-top: 1rem;
      border-radius: 0.5rem;
      border: none;
      font-size: 1rem;
    }
    button {
      background-color: #10b981;
      color: white;
      font-weight: bold;
      cursor: pointer;
      margin-top: 1.5rem;
    }
    .branding {
      font-size: 1rem;
      font-weight: bold;
      text-align: center;
      margin-top: 2rem;
      color: #065f46;
    }
    .frase {
      font-style: italic;
      margin-bottom: 1.2rem;
      color: #047857;
    }
    .selector {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 2rem;
    }
    #imagen-preview {
      margin-top: 1rem;
      max-width: 100%;
      border-radius: 10px;
    }
    .historial-item {
      padding: 1rem;
      border-bottom: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <div class="branding">🧭 Brújula Interna 3.0</div>

  <!-- Pantalla inicial -->
  <div class="step active" id="inicio">
    <h1>¿Dónde te encuentras en tu día?</h1>
    <p class="frase">Escoge tu momento. No importa la hora, importa tu intención.</p>
    <div class="selector">
      <button onclick="iniciarManana()">🌅 Empezar mi día</button>
      <button onclick="iniciarNoche()">🌇 Reflexionar mi día</button>
      <button onclick="mostrarHistorial()">📆 Ver mi semana</button>
    </div>
  </div>
  <!-- Modo MAÑANA -->
  <div class="step" id="manana">
    <h1>🌞 Rumbo del día</h1>
    <p class="frase" id="fraseManana"></p>
    <label>🎯 ¿Qué 3 cosas quiero hacer hoy?</label>
    <input type="text" id="m1" placeholder="Ej: Salir a caminar" />
    <input type="text" id="m2" placeholder="Ej: Leer 10 minutos" />
    <input type="text" id="m3" placeholder="Ej: Hablar con alguien con calma" />
    <label>🌀 ¿Cómo me siento al comenzar?</label>
    <select id="energia">
      <option value="Alta">Alta ⚡</option>
      <option value="Media">Media 🔄</option>
      <option value="Baja">Baja 🌱</option>
    </select>
    <label>💚 ¿Qué actitud quiero cultivar?</label>
    <input type="text" id="actitud" placeholder="Ej: Amabilidad / Claridad / Paciencia" />
    <button onclick="guardarManana()">Guardar mi rumbo</button>
  </div>

  <!-- Modo NOCHE -->
  <div class="step" id="noche">
    <h1>🌙 Bitácora del día</h1>
    <p class="frase" id="fraseNoche"></p>
    <label>🌟 ¿Qué hice hoy que me gustó?</label>
    <textarea id="logro" rows="2"></textarea>
    <label>🧱 ¿Qué me costó más?</label>
    <textarea id="dificil" rows="2"></textarea>
    <label>💭 ¿Qué me repito con cariño?</label>
    <textarea id="mensaje" rows="2" placeholder="Ej: Estoy aprendiendo a estar presente."></textarea>

    <h2>🌱 Identidad y evolución</h2>
    <label>🪞 ¿Qué hago, siento o pienso que me convierte en un buen…?</label>
    <textarea id="identidad1" rows="2" placeholder="Ej: estudiante, profesional, cuidador..."></textarea>
    <label>🧠 ¿Qué comportamientos o acciones me convierten en eso?</label>
    <textarea id="identidad2" rows="2"></textarea>

    <h2>📷 Imagen opcional</h2>
    <input type="file" accept="image/*" id="imagen" onchange="mostrarImagen(event)">
    <img id="imagen-preview" style="display:none;" />
    <button onclick="quitarImagen()">Quitar imagen</button>

    <button onclick="guardarNoche()">Guardar mi reflexión</button>
  </div>
  <!-- Resultado -->
  <div class="step" id="resultado">
    <h1>📖 Tu registro de hoy</h1>
    <div id="resumen"></div>
    <button onclick="copiarTexto()">📋 Copiar texto</button>
    <button onclick="exportarComoPNG()">🖼️ Guardar como imagen</button>
    <button onclick="reiniciar()">Registrar otro momento</button>
  </div>

  <!-- Historial -->
  <div class="step" id="historial">
    <h1>📆 Mi semana</h1>
    <div id="lista-historial"></div>
    <button onclick="reiniciar()">Volver al inicio</button>
  </div>

  <script>
    const frasesManana = [
      "Hoy no tienes que hacerlo todo. Solo avanzar con intención.",
      "Un día amable comienza con una pausa consciente.",
      "Estás trazando tu rumbo. Cada paso importa.",
      "Iniciar con claridad es un acto de cuidado personal."
    ];
    const frasesNoche = [
      "Hoy ya forma parte de tu camino.",
      "Todo lo que hiciste (o no), te enseñó algo.",
      "Cerrar el día es también un acto de amor propio.",
      "Tu brújula sigue activa, incluso cuando descansas."
    ];

    let imagenSeleccionada = null;

    function mostrarPaso(id) {
      document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function iniciarManana() {
      document.getElementById('fraseManana').textContent = frasesManana[Math.floor(Math.random() * frasesManana.length)];
      mostrarPaso('manana');
    }

    function iniciarNoche() {
      document.getElementById('fraseNoche').textContent = frasesNoche[Math.floor(Math.random() * frasesNoche.length)];
      mostrarPaso('noche');
    }

    function guardarManana() {
      const data = {
        fecha: new Date().toLocaleDateString(),
        tipo: 'mañana',
        m1: document.getElementById('m1').value,
        m2: document.getElementById('m2').value,
        m3: document.getElementById('m3').value,
        energia: document.getElementById('energia').value,
        actitud: document.getElementById('actitud').value
      };
      guardarEnHistorial(data);
      mostrarResumen(data);
    }

    function guardarNoche() {
      const data = {
        fecha: new Date().toLocaleDateString(),
        tipo: 'noche',
        logro: document.getElementById('logro').value,
        dificil: document.getElementById('dificil').value,
        mensaje: document.getElementById('mensaje').value,
        identidad1: document.getElementById('identidad1').value,
        identidad2: document.getElementById('identidad2').value,
        imagen: imagenSeleccionada
      };
      guardarEnHistorial(data);
      mostrarResumen(data);
    }

    function mostrarResumen(data) {
      let resumen = `<p><strong>📅 Fecha:</strong> ${data.fecha}</p>`;

      if (data.tipo === 'mañana') {
        const emoji = data.energia === 'Alta' ? '⚡' : data.energia === 'Media' ? '🌀' : '🌱';
        resumen += `
          <p>🎯 <strong>Objetivos:</strong><br>– ${data.m1}<br>– ${data.m2}<br>– ${data.m3}</p>
          <p>${emoji} <strong>Energía:</strong> ${data.energia}</p>
          <p>💚 <strong>Actitud:</strong> ${data.actitud}</p>`;
      } else {
        const emLogro = data.logro ? '🌟' : '🫥';
        const emDif = /frustrado|nada|cansado|difícil|ansiedad/i.test(data.dificil) ? '🌧️' : '🧩';
        const emMsg = data.mensaje ? '💭' : '🤍';

        resumen += `
          <p>${emLogro} <strong>Logro:</strong> ${data.logro || 'Sin registrar'}</p>
          <p>${emDif} <strong>Dificultad:</strong> ${data.dificil || 'Sin registrar'}</p>
          <p>${emMsg} <strong>Mensaje amable:</strong> ${data.mensaje || 'Sin registrar'}</p>
          <p>🪞 <strong>Identidad:</strong> ${data.identidad1 || '—'}<br>🧠 ${data.identidad2 || '—'}</p>`;
        if (data.imagen) {
          resumen += `<p><img src="${data.imagen}" alt="Imagen del día" style="max-width:100%; border-radius:10px;" /></p>`;
        }
      }

      document.getElementById('resumen').innerHTML = resumen;
      mostrarPaso('resultado');
    }

    function guardarEnHistorial(data) {
      let historial = JSON.parse(localStorage.getItem('historial-brujula')) || [];
      historial.unshift(data);
      localStorage.setItem('historial-brujula', JSON.stringify(historial.slice(0, 7)));
    }

    function mostrarHistorial() {
      const contenedor = document.getElementById('lista-historial');
      contenedor.innerHTML = '';
      const historial = JSON.parse(localStorage.getItem('historial-brujula')) || [];

      if (historial.length === 0) {
        contenedor.innerHTML = '<p>No hay entradas aún.</p>';
      } else {
        historial.forEach(entry => {
          const emoji = entry.tipo === 'mañana'
            ? entry.energia === 'Alta' ? '⚡' : entry.energia === 'Media' ? '🌀' : '🌱'
            : entry.logro ? '🌟' : '🫥';
          contenedor.innerHTML += `<div class="historial-item">📅 ${entry.fecha} — ${emoji}</div>`;
        });
      }

      mostrarPaso('historial');
    }

    function reiniciar() {
      mostrarPaso('inicio');
    }

    function mostrarImagen(event) {
      const reader = new FileReader();
      reader.onload = function (e) {
        imagenSeleccionada = e.target.result;
        const img = document.getElementById('imagen-preview');
        img.src = imagenSeleccionada;
        img.style.display = 'block';
      };
      reader.readAsDataURL(event.target.files[0]);
    }

    function quitarImagen() {
      imagenSeleccionada = null;
      const img = document.getElementById('imagen-preview');
      img.src = '';
      img.style.display = 'none';
    }

    function copiarTexto() {
      const resumenText = document.getElementById('resumen').innerText;
      navigator.clipboard.writeText(resumenText).then(() => {
        alert('Texto copiado al portapapeles');
      });
    }

    function exportarComoPNG() {
      html2canvas(document.getElementById('resumen')).then(canvas => {
        const link = document.createElement('a');
        link.download = 'bitacora.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</body>
</html>
